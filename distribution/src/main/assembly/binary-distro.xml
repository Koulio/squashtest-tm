<!--

        This file is part of the Squashtest platform.
        Copyright (C) 2010 - 2011 Squashtest TM, Squashtest.org

        See the NOTICE file distributed with this work for additional
        information regarding copyright ownership.

        This is free software: you can redistribute it and/or modify
        it under the terms of the GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        this software is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU Lesser General Public License for more details.

        You should have received a copy of the GNU Lesser General Public License
        along with this software.  If not, see <http://www.gnu.org/licenses/>.

-->
<assembly
	xmlns="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.0 http://maven.apache.org/xsd/assembly-1.1.0.xsd">
	<id>binary-distro</id>
	<formats>
		<format>dir</format>
		<format>zip</format>
		<format>tar.gz</format>
	</formats>

	<baseDirectory>${distro.directory.name}</baseDirectory>

	<dependencySets>
		<dependencySet>
			<outputDirectory>bin</outputDirectory>
			<includes>
				<include>org.apache.felix:${felix.artifactId}</include>
			</includes>
		</dependencySet>
		<dependencySet>
			<outputDirectory>bin</outputDirectory>
			<includes>
				<include>org.squashtest.csp:squashtest-csp-launcher</include>
			</includes>
			<outputFileNameMapping>${squash.launcher.name}</outputFileNameMapping>
		</dependencySet>
		<dependencySet>
			<outputDirectory>bundles</outputDirectory>
			<includes>
				<include>*:*:jar</include>
			</includes>
			<excludes>
				<exclude>org.apache.felix:${felix.artifactId}</exclude>
				<exclude>org.codehaus.izpack:*</exclude>
				<exclude>*:*:pom:*</exclude>
			</excludes>
			<useTransitiveDependencies>false</useTransitiveDependencies>
		</dependencySet>
		<dependencySet>
			<!-- web bundles need to be renamed as jars for felix to start them -->
			<outputDirectory>bundles</outputDirectory>
			<includes>
				<include>*:*:war</include>
			</includes>
			<outputFileNameMapping>${artifact.artifactId}-${artifact.version}${dashClassifier?}.jar</outputFileNameMapping>
			<useTransitiveDependencies>false</useTransitiveDependencies>
		</dependencySet>
		<dependencySet>
			<outputDirectory>bundles</outputDirectory>
			<includes>
				<include>*:*</include>
			</includes>
			<excludes>
				<exclude>org.apache.felix:${felix.artifactId}</exclude>
				<exclude>org.squashtest.csp:squashtest-csp-launcher</exclude>
			</excludes>
			<useTransitiveDependencies>false</useTransitiveDependencies>
			<scope>provided</scope>
		</dependencySet>
	</dependencySets>
	
	<moduleSets>
		<moduleSet>
			<useAllReactorProjects>true</useAllReactorProjects>
			<includes>
				<include>${project.groupId}:*.tm.*</include>
				<include>${project.groupId}:org.squashtest.csp.core.log4j</include>
				<include>${project.groupId}:org.squashtest.csp.core.web</include>
				<include>${project.groupId}:org.squashtest.csp.core.service</include>
				<include>${project.groupId}:org.squashtest.csp.core.bugtracker</include>
				<include>${project.groupId}:org.squashtest.csp.core.jetty.start.osgi</include>
			</includes>
			<binaries>
				<outputDirectory>bundles</outputDirectory>
				<unpack>false</unpack>
				<dependencySets>
					<dependencySet>
						<includes>
							<include>${project.groupId}:*:war:*</include>
						</includes>
						<outputFileNameMapping>${artifact.artifactId}-${artifact.version}${dashClassifier?}.jar</outputFileNameMapping>
					</dependencySet>
				</dependencySets>
			</binaries>
		</moduleSet>
	</moduleSets>
	
	<fileSets>
		<!-- 
		<fileSet>
			<directory>src/main/resources/bin</directory>
			<filtered>true</filtered>
			<outputDirectory>bin</outputDirectory>
		</fileSet>
		<fileSet>
			<
			<directory>src/main/resources/conf</directory>
			<filtered>true</filtered>
			<outputDirectory>conf</outputDirectory>
		</fileSet>
		-->
		<fileSet>
			<directory>src/main/resources</directory>
			<filtered>true</filtered>
			<excludes>
				<exclude>
					equinox/				
				</exclude>
			</excludes>
			<outputDirectory>.</outputDirectory>
		</fileSet>		
		<fileSet>
			<directory>${project.build.directory}/data</directory>
			<outputDirectory>data</outputDirectory>
		</fileSet>
		<fileSet>
			<directory>${project.build.directory}/database-scripts</directory>
			<outputDirectory>database-scripts</outputDirectory>
		</fileSet>
	</fileSets>
</assembly>
